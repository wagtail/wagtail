{% extends "layout.html" %}
{% set title = _('Search') %}

{% block body %}
  <noscript>
  <div id="fallback" class="admonition warning">
    <p class="last">
      {% trans trimmed %}Please activate JavaScript to enable the search
      functionality.{% endtrans %}
    </p>
  </div>
  </noscript>

  <div id="search-results">
  </div>
{% endblock %}

{% block footer %}
{{ super() }}
<script>

function makeHitElement(hitData) {
  console.log(hitData)
  const hitListElement = document.createElement('li')
  hitListElement.textContent = "Hit"
  return hitListElement
}

function runSearchPageSearch(event) {
  const urlParams = new URLSearchParams(window.location.search)
  const query = urlParams.get('q')
  const searchResultsContainer = document.getElementById('search-results')

  const searchHeading = document.createElement('h1')
  searchHeading.textContent = query
  searchResultsContainer.appendChild(searchHeading)

  const search = docSearchReady()
  const index = search.client.initIndex('wagtail')
  index.search(query).then(({ hits }) => {
    console.log(hits);
    const searchResultsList = document.createElement('ul')
    for (hit of hits) {
      const hitElement = makeHitElement(hit)
      searchResultsList.appendChild(hitElement)
    }
    searchResultsContainer.appendChild(searchResultsList)
  }).catch((error) => console.log(error))
}

window.onload = runSearchPageSearch
</script>
{% endblock %}