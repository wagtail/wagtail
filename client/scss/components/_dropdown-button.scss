$separator: 1px solid theme('colors.white-15');
$radius: theme('borderRadius.sm');

.w-dropdown-button {
  display: inline-flex;
  // Make sure the tooltip within will match this element’s width.
  position: relative;

  [data-tippy-root] {
    // Make sure the tooltip within will match this element’s width.
    width: 100%;
  }

  // Cosmetic details based on live tooltip placement,
  // implemented CSS-only by using Tippy.js `data-placement` and `:has`.
  --primary-button-radius: #{$radius} 0 0 #{$radius};
  --toggle-button-radius: 0 #{$radius} #{$radius} 0;
  // Set each separately so a button that’s both first and last is correct.
  --first-item-start-start-radius: 0;
  --first-item-start-end-radius: 0;
  --last-item-end-start-radius: 0;
  --last-item-end-end-radius: 0;

  // Use no corner radius and always-on borders if `:has` is not supported.
  @supports not selector(:has(*)) {
    --primary-button-radius: 0;
    --toggle-button-radius: 0;
    --first-item-border-top: #{$separator};
    --last-item-border-bottom: #{$separator};
  }

  &:has([data-placement^='bottom']) {
    --primary-button-radius: #{$radius} 0 0 0;
    --toggle-button-radius: 0 #{$radius} 0 0;
    --last-item-end-start-radius: #{$radius};
    --last-item-end-end-radius: #{$radius};
    --first-item-border-top: #{$separator};
  }

  &:has([data-placement^='top']) {
    --primary-button-radius: 0 0 0 #{$radius};
    --toggle-button-radius: 0 0 #{$radius} 0;
    --first-item-start-start-radius: #{$radius};
    --first-item-start-end-radius: #{$radius};
    --last-item-border-bottom: #{$separator};
  }
}

// Primary button next to the dropdown toggle.
.w-dropdown-button > :is(a, button) {
  border-radius: var(--primary-button-radius);
  min-height: $text-input-height;
}

.w-dropdown-button .w-dropdown__toggle {
  width: theme('spacing.8');
  height: $text-input-height;
  padding: 0 theme('spacing.2');
  background-color: theme('colors.surface-button-default');
  color: theme('colors.text-button');
  border-inline-start: $separator;
  border-radius: var(--toggle-button-radius);

  &:is(:hover, :focus-visible) {
    background-color: theme('colors.surface-button-hover');
  }
}

.w-dropdown-button .w-dropdown__content {
  padding: 0;
}

// Use a generic selector to support all types of links / buttons.
.w-dropdown-button .w-dropdown__content :is(a, button) {
  @include show-focus-outline-inside();
  height: auto;
  min-height: $text-input-height;
  margin: 0;
  white-space: normal;
  border-radius: 0;

  .icon {
    opacity: 1;
    margin-inline-end: 0;
  }

  &:nth-child(n + 2) {
    border-top: $separator;
  }

  &:first-child {
    border-top: var(--first-item-border-top);
    border-start-start-radius: var(--first-item-start-start-radius);
    border-start-end-radius: var(--first-item-start-end-radius);
  }

  &:last-child {
    border-bottom: var(--last-item-border-bottom);
    border-end-start-radius: var(--last-item-end-start-radius);
    border-end-end-radius: var(--last-item-end-end-radius);
  }
}
