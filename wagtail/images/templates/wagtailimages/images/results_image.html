{% comment %}
 Separated out of results.html to prevent invalid images from crashing the entire
 images listing. (issue #1805)

 If an error is raised inside a template include, the error is caught by the
 calling {% include %} tag and the contents blanked out.

 This behaviour caused a confusing error on the images listing view where it
 would go blank if one of the images was invalid.

 Separating the image rendering code into this file allows us to limit Django's
 crash/blanking behaviour to a single image so the listing can still be used when
 the issue occurs.
{% endcomment %}

{% load wagtailimages_tags %}
{% load i18n l10n %}


<div class="image-wrapper">
  <div class="image border border-gray-300 rounded-md overflow-hidden">
    {% image image max-165x165 class="show-transparency" alt=image.title %}
  </div>

  <!-- Hover modal -->
  <div class="metadata-modal">
    <p><strong>Title:</strong> {{ image.title }}</p>
    <p><strong>Size:</strong> {{ image.width|localize }} Ã— {{ image.height|localize }} px</p>
    {% with image.file.name|lower as filename %}
      {% if filename|slice:"-4:" == "jpeg" %}
        <p><strong>Format: JPEG</strong></p>
      {% else %}
        <p><strong>Format:</strong> {{ filename|slice:"-3:"|upper }}</p>
      {% endif %}
    {% endwith %}
    {% widthratio image.file_size 1024 1 as filesize_kb %}
    <p><strong>File Size:</strong> {{ filesize_kb|localize }} KB</p>
    <p><strong>Created:</strong> {{ image.created_at|date:"Y-m-d H:i" }}</p>
    <p><strong>Updated:</strong> {{ image.updated_at|date:"Y-m-d H:i" }}</p>
    {% if image.uploaded_by_user %}
      <p><strong>Uploaded by:</strong>
        {{ image.uploaded_by_user.get_full_name|default:image.uploaded_by_user.username }}
      </p>
    {% endif %}
  </div>
</div>
