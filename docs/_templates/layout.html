{% extends "!layout.html" %}

{% block extrahead %}
<link rel="stylesheet" href="{{ docsearch_base ~ 'docsearch.min.css' }}"/>
<link rel="stylesheet" href="{{ pathto('_static/css/docsearch.overrides.css', 1) }}" />
{% endblock %}

{% block footer %}
{{ super() }}
<script async defer data-domain="docs.wagtail.io" src="https://plausible.io/js/plausible.js"></script>
{% set docsearch_version = '2' %}
{% set docsearch_base = 'https://cdn.jsdelivr.net/npm/docsearch.js@' ~ docsearch_version ~ '/dist/cdn/' %}

<script>
function docSearchReady(script) {
  /**
   * Configure Algolia DocSearch.
   *
   * PR builds have their version set to the PR ID (e.g. "6753").
   * If the docs are built for a PR, use the "latest" search index.
   * Otherwise, use the search index for the current version.
   */
  const rtd_version = (window.READTHEDOCS_DATA || {}).version || 'latest';
  const version = rtd_version.match(/^\d+$/) ? 'latest' : rtd_version;

  window.search = docsearch({
    apiKey: '8325c57d16798633e29d211c26c7b6f9',
    indexName: 'wagtail',
    inputSelector: '#rtd-search-form [name="q"]',
    algoliaOptions: {
      facetFilters: ['version:' + version],
    },
    autocompleteOptions: {
      autoSelect: false
    },
    debug: true // Set debug to true if you want to inspect the dropdown
  });
}

const s = document.createElement('script');
s.src = '{{ docsearch_base }}docsearch.min.js';
s.onload = docSearchReady;
document.body.appendChild(s);
</script>
{% endblock %}
